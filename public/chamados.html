<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Chamados em Aberto</title>
  <style>
    body {
      font-family: Arial;
      background-color: #f4f4f4;
      padding: 20px;
    }
    h2 {
      color: #004080;
    }
    .chamado {
      background-color: white;
      padding: 15px;
      margin: 10px 0;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .atualizar {
      background-color: #004080;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 10px 0;
    }
    .atualizar:hover {
      background-color: #003060;
    }
    .voltar {
      background-color: #666;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 10px 0;
      text-decoration: none;
      display: inline-block;
    }
    .voltar:hover {
      background-color: #555;
    }
  </style>
</head>
<body>
  <a href="index.html" class="voltar">‚Üê Voltar para Formul√°rio</a>
  <h2>Chamados em Aberto</h2>
  <button class="atualizar" onclick="carregarChamados()">üîÑ Atualizar Lista</button>
  <div id="listaChamados"></div>
  
  <script>
    function carregarChamados() {
      console.log('Carregando chamados...');
      
      // URL CORRIGIDA - usando o Render
      fetch('https://helpdesklippel-1.onrender.com/api/chamados')
        .then(response => {
          console.log('Status:', response.status);
          return response.json();
        })
        .then(chamados => {
          console.log('Chamados recebidos:', chamados);
          const lista = document.getElementById('listaChamados');
          
          if (chamados.length === 0) {
            lista.innerHTML = "<p>Nenhum chamado encontrado.</p>";
          } else {
            lista.innerHTML = ''; // Limpa a lista antes de adicionar novos itens
            
            chamados.forEach((chamado) => {
              const div = document.createElement('div');
              div.classList.add('chamado');
              div.innerHTML = `
                <strong>Nome:</strong> ${chamado.nome}<br>
                <strong>Setor:</strong> ${chamado.setor}<br>
                <strong>Prioridade:</strong> ${chamado.prioridade}<br>
                <strong>Descri√ß√£o:</strong> ${chamado.problema}<br>
                <small><em>Data: ${new Date(chamado.created_at).toLocaleString()}</em></small>
              `;
              lista.appendChild(div);
            });
          }
        })
        .catch(error => {
          console.error('Erro ao buscar chamados:', error);
          document.getElementById('listaChamados').innerHTML = "<p>Erro ao carregar os chamados.</p>";
        });
    }
    
    // Carregar chamados quando a p√°gina abrir
    carregarChamados();
    
    // Atualizar a cada 30 segundos
    setInterval(carregarChamados, 30000);
  </script>
</body>
</html>