<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chamados LIPPEL</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@600;700&family=Nunito:wght@400;600&display=stylesheet" rel="stylesheet">
    <link rel="icon" type="image/png" href="img/favicon-32x32.png">
    
    <style>
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); }
        .modal-content { background-color: #fff; margin: 15% auto; padding: 30px; border-radius: 10px; width: 80%; max-width: 500px; text-align: center; position: relative; }
        .modal-content h2 { color: #0052a3; font-family: 'Exo 2', sans-serif; }
        .modal-content p { color: #333; font-family: 'Nunito', sans-serif; }
        .close-button { color: #aaa; position: absolute; top: 10px; right: 20px; font-size: 28px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <div id="welcomeModal" class="modal">
        <div class="modal-content">
            <span id="closeModalButton" class="close-button">&times;</span>
            <h2>Bem-vindo ao Sistema de Chamados!</h2>
            <p>Esta é uma versão de testes da nossa nova plataforma.</p>
            <p>Caso encontre qualquer erro, comunique à equipe de desenvolvimento.</p>
        </div>
    </div>

    <header>
       <img id="imagem-lpp" src="img/lippel-removebg-preview.png" alt="imagem-lippel">
    </header>
    <main>
        <section class="container">
            <div id="form">
              <h2 id="texto1">Abrir Chamado</h2>
              <form id="formulario">
                <p>*Digite seu nome</p>
                <input type="text" id="txtname" placeholder="Digite seu nome" required>
                <p>*Qual seu Setor?</p>
                <select id="setor" required> 
                    <option value="" disabled selected>Selecione seu setor</option>
                    <option value="1">PCP</option>
                    <option value="2">ENGENHARIA</option>
                    <option value="3">COMERCIAL</option>
                    <option value="4">ADMINISTRATIVO</option>
                    <option value="5">ALMOXARIFADO</option>
                    <option value="6">PROCESSOS</option>
                    <option value="7">TI</option>
                </select>
                <p>*Descreva o Problema</p>
                <textarea id="problema" placeholder="Descreva o Problema" required></textarea>
                <p>*Tipo de Solicitação</p>
                <select id="area" required> <option value="" disabled selected>Selecione o tipo</option>
                    <option value="SUPORTE TÉCNICO">SUPORTE TÉCNICO</option>
                    <option value="DESENVOLVIMENTO">DESENVOLVIMENTO</option>
                </select>
                <p>*Prioridade</p>
                <select id="prioridade" required>
                    <option value="" disabled selected>Selecione</option>
                    <option value="baixa">Baixa</option>
                    <option value="média">Média</option>
                    <option value="alta">Alta</option>
                    <option value="crítica">Crítica</option>
                </select>
                <p>*Nível de Interferência</p>
                <select id="interferencia" required>
                    <option value="" disabled selected>Selecione</option>
                    <option value="nenhuma">Nenhuma</option>
                    <option value="leve">Leve</option>
                    <option value="média">Média</option>
                    <option value="grave">Grave</option>
                </select>
                <button type="button" onclick="enviarChamado()" class="btn-enviar" id="btn-submit">Enviar</button>
                <button type="button" onclick="window.location.href='chamados.html'">Ver Chamados em Aberto</button>
              </form>  
            </div>
        </section>
    </main>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
        const supabaseUrl = 'https://izkkozkulgjpejyvcmiw.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6a2tvemt1bGdqcGVqeXZjbWl3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0ODcwNzYsImV4cCI6MjA3MDA2MzA3Nn0.oyLHuA3n3ZlMuHWaMF4OEbSWMmhIYzeIE7LuFJFY7MA';
        const { createClient } = window.supabase;
        const supabaseClient = createClient(supabaseUrl, supabaseKey);
        window.supabaseClient = supabaseClient;

        // Script de autenticação que evita loops
        supabaseClient.auth.onAuthStateChange(async (event, session) => {
            if (!session) {
                window.location.href = 'login.html';
            } else {
                showWelcomeModal();
            }
        });

        // Função para mostrar a janela de aviso
        function showWelcomeModal() {
            if (!sessionStorage.getItem('welcomeModalShown')) {
                const modal = document.getElementById('welcomeModal');
                const closeButton = document.getElementById('closeModalButton');
                if (modal && closeButton) {
                    modal.style.display = 'block';
                    sessionStorage.setItem('welcomeModalShown', 'true');
                    closeButton.onclick = () => { modal.style.display = 'none'; };
                    window.onclick = (event) => {
                        if (event.target == modal) {
                            modal.style.display = 'none';
                        }
                    };
                }
            }
        }
    </script>
    <script src="script.js"></script>
</body> 
</html>